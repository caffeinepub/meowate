{
  "kind": "build_request",
  "title": "Enable TURN-only mode to reduce WebRTC \"failed to match\" errors",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the WebRTC configuration so matchmaking voice calls use TURN-only (relay-only) ICE, forcing connections to be established via TURN relay instead of attempting direct P2P (host/srflx) candidates.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1",
          "msg-2"
        ],
        "quotes": [
          "Want me to enable TURN-only mode for your app?",
          "Okay"
        ]
      },
      "acceptanceCriteria": [
        "In frontend/src/hooks/useWebRTC.ts, RTCPeerConnection is created with an RTCConfiguration that enforces TURN-only behavior (e.g., iceTransportPolicy set to \"relay\").",
        "When attempting a match on restrictive networks (e.g., double NAT), ICE candidates generated/sent are relay candidates, and the diagnostics field usingTurnServer becomes true during the connection attempt.",
        "No regression: matching flow still transitions out of \"connecting\" via the existing timeout/error handling if the relay connection cannot be established."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo; do not introduce additional canisters/services.",
    "Do not edit frontend immutable paths: frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, and anything under frontend/src/components/ui."
  ],
  "nonGoals": [
    "Adding or integrating a private/paid TURN provider or credential management UI.",
    "Implementing new backend signaling protocols or changing matchmaking algorithms beyond what is required to force TURN-only ICE."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}